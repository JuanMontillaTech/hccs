(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{882:function(e,r,t){"use strict";t.r(r);t(25);var o=t(30),n=(t(19),t(4),t(2),t(76),t(75),{data:function(){return{companies:[],selectedCompany:null,users:[],selectedUser:null,roles:[],selectedRole:null,forms:[],allForms:[],selectedFormToAdd:null}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.fetchCompanies();case 2:return r.next=4,e.fetchAllForms();case 4:case"end":return r.stop()}}),r)})))()},methods:{fetchCompanies:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$axios.get("SysCompany/GetAll");case 3:t=r.sent,e.companies=t.data.data.map((function(e){return{value:e.id,text:e.companyName}})),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("Error al obtener compañías:",r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},fetchUsers:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.selectedCompany){r.next=15;break}return r.prev=1,r.next=4,e.$axios.get("SysUserCompany/GetCompanyId?companyId=".concat(e.selectedCompany));case 4:t=r.sent,e.users=t.data.data.data.map((function(e){return{id:e.sysUser.email,name:e.sysUser.email}})),e.roles=[],e.forms=[],r.next=13;break;case 10:r.prev=10,r.t0=r.catch(1),console.error("Error al obtener usuarios:",r.t0);case 13:r.next=16;break;case 15:e.users=[];case 16:case"end":return r.stop()}}),r,null,[[1,10]])})))()},fetchRoles:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.selectedUser){r.next=15;break}return r.prev=1,console.log(e.selectedUser,"Ri"),r.next=5,e.$axios.get("UserRoll/GetByemailUser?email=".concat(e.selectedUser));case 5:t=r.sent,e.roles=t.data.data.data.map((function(e){return{id:e.rollId,name:e.rolles.name}})),e.forms=[],r.next=13;break;case 10:r.prev=10,r.t0=r.catch(1),console.error("Error al obtener roles:",r.t0);case 13:r.next=16;break;case 15:e.roles=[];case 16:case"end":return r.stop()}}),r,null,[[1,10]])})))()},fetchForms:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.selectedRole){r.next=13;break}return r.prev=1,r.next=4,e.$axios.get("RollForm/GetFormId?RollId=".concat(e.selectedRole));case 4:t=r.sent,e.forms=t.data.data.data.filter((function(e){return e.froms})).map((function(e){return{id:e.id,title:e.froms.title}})),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),console.error("Error al obtener formularios:",r.t0);case 11:r.next=14;break;case 13:e.forms=[];case 14:case"end":return r.stop()}}),r,null,[[1,8]])})))()},fetchAllForms:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$axios.get("Form/GetAll");case 3:t=r.sent,e.allForms=t.data.data.map((function(form){return{value:form.id,text:form.title}})),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("Error al obtener todos los formularios:",r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},addForm:function(){this.selectedFormToAdd=null,this.$refs.formModal.show()},saveForm:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,e.selectedRole&&e.selectedFormToAdd){r.next=4;break}return e.$toast.error("Selecciona un rol y un formulario.","Error",e.izitoastConfig),r.abrupt("return");case 4:return data={rollId:e.selectedRole,formId:e.selectedFormToAdd,lastModifiedDate:new Date,createdDate:new Date,isActive:!0},r.next=7,e.$axios.post("RollForm/Create",data);case 7:return e.$toast.success("Formulario agregado correctamente.","Éxito",e.izitoastConfig),r.next=10,e.fetchForms();case 10:e.$refs.formModal.hide(),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),e.$toast.error(r.t0.message,"Error al agregar formulario",e.izitoastConfig);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))()},removeForm:function(e){var r=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r.selectedRole&&e){t.next=4;break}return r.$toast.error("Selecciona un rol y un formulario.","Error",r.izitoastConfig),t.abrupt("return");case 4:if(o=r.forms.find((function(form){return form.id===e}))){t.next=8;break}return r.$toast.error("No se encontró la relación RollForm.","Error",r.izitoastConfig),t.abrupt("return");case 8:return n=o.id,t.next=11,r.$axios.delete("RollForm/Delete/".concat(n));case 11:return r.$toast.success("Formulario eliminado correctamente.","Éxito",r.izitoastConfig),t.next=14,r.fetchForms();case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),r.$toast.error(t.t0.message,"Error al eliminar formulario",r.izitoastConfig);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))()},handleSubmit:function(){console.log("Formulario enviado:",this.selectedCompany,this.selectedUser,this.selectedRole,this.forms)}}}),l=t(18),component=Object(l.a)(n,(function(){var e=this,r=e._self._c;return r("div",[r("div",{staticClass:"card"},[r("div",{staticClass:"card-body"},[r("h4",[e._v("Gestión de Cuentas de Usuarios")]),e._v(" "),r("b-form",{on:{submit:function(r){return r.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[r("b-form-group",{attrs:{label:"Base de Datos","label-for":"companySelect"}},[r("b-form-select",{attrs:{id:"companySelect",options:e.companies,required:""},on:{change:e.fetchUsers},scopedSlots:e._u([{key:"first",fn:function(){return[r("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v("-- Selecciona una base de datos --")])]},proxy:!0}]),model:{value:e.selectedCompany,callback:function(r){e.selectedCompany=r},expression:"selectedCompany"}})],1),e._v(" "),e.users.length>0?r("b-form-group",{attrs:{label:"Usuario","label-for":"userSelect"}},[r("b-form-select",{attrs:{id:"userSelect",required:""},on:{change:e.fetchRoles},scopedSlots:e._u([{key:"first",fn:function(){return[r("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v("-- Selecciona un usuario --")])]},proxy:!0}],null,!1,1598740083),model:{value:e.selectedUser,callback:function(r){e.selectedUser=r},expression:"selectedUser"}},[e._v(" "),e._l(e.users,(function(t){return r("b-form-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],2)],1):e._e(),e._v(" "),e.roles.length>0?r("b-form-group",{attrs:{label:"Rol","label-for":"roleSelect"}},[r("b-form-select",{attrs:{id:"roleSelect",required:""},on:{change:e.fetchForms},scopedSlots:e._u([{key:"first",fn:function(){return[r("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v("-- Selecciona un rol --")])]},proxy:!0}],null,!1,2254620836),model:{value:e.selectedRole,callback:function(r){e.selectedRole=r},expression:"selectedRole"}},[e._v(" "),e._l(e.roles,(function(t){return r("b-form-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],2)],1):e._e(),e._v(" "),e.forms.length>0?r("div",[r("h5",[e._v("Formularios asociados al rol:")]),e._v(" "),r("b-button",{staticClass:"btn-sm",attrs:{variant:"primary"},on:{click:e.addForm}},[r("i",{staticClass:"bx bx-plus"})]),e._v(" "),r("b-list-group",e._l(e.forms,(function(form){return r("b-list-group-item",{key:form.id},[e._v("\n          "+e._s(form.title)+"\n          "),r("b-button",{staticClass:"float-right btn-sm",attrs:{size:"sm",variant:"danger"},on:{click:function(r){return e.removeForm(form.id)}}},[r("i",{staticClass:"bx bx-trash"})])],1)})),1),e._v(" "),r("b-button",{staticClass:"btn-sm",attrs:{variant:"primary"},on:{click:e.addForm}},[r("i",{staticClass:"bx bx-plus"})])],1):e._e()],1),e._v(" "),r("b-modal",{ref:"formModal",attrs:{title:"Agregar Formulario","hide-footer":""}},[r("b-form",{on:{submit:function(r){return r.preventDefault(),e.saveForm.apply(null,arguments)}}},[r("b-form-group",{attrs:{label:"Formulario","label-for":"modalFormSelect"}},[r("b-form-select",{attrs:{id:"modalFormSelect",options:e.allForms,required:""},model:{value:e.selectedFormToAdd,callback:function(r){e.selectedFormToAdd=r},expression:"selectedFormToAdd"}})],1),e._v(" "),r("b-button",{staticClass:"btn-sm",attrs:{type:"submit",variant:"primary"}},[e._v("Guardar")])],1)],1)],1)])])}),[],!1,null,null,null);r.default=component.exports}}]);