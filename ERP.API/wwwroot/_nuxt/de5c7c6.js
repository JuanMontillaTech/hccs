(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{683:function(e,t,r){"use strict";var n=r(15),c=r(78).findIndex,o=r(88),d=r(69),l="findIndex",f=!0,m=d(l);l in[]&&Array(1)[l]((function(){f=!1})),n({target:"Array",proto:!0,forced:f||!m},{findIndex:function(e){return c(this,e,arguments.length>1?arguments[1]:void 0)}}),o(l)},877:function(e,t,r){"use strict";r.r(t);r(105),r(23),r(7),r(8),r(4),r(2),r(9),r(6),r(10);var n=r(0),c=r(30),o=(r(19),r(25),r(18),r(683),r(75),r(597)),d=r.n(o);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m={data:function(){return{selectedFormId:null,forms:[],rowId:null,ledgerAccounts:[],ledgerAccountFields:[{key:"name",label:"Nombre"},{key:"code",label:"Código"},{key:"index",label:"Orden"},{key:"actions",label:"Acciones"}],allLedgerAccounts:[],selectedLedgerAccountId:null,selectedLedgerOrden:0}},mounted:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchForms();case 2:return t.next=4,e.fetchAllLedgerAccounts();case 4:case"end":return t.stop()}}),t)})))()},methods:{fetchForms:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("Form/GetAllHss");case 3:r=t.sent,e.forms=r.data.data.map((function(form){return{value:form.id,text:form.title}})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.$toast.error(t.t0.message,"Error al obtener formularios",e.izitoastConfig);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},fetchLedgerAccounts:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.selectedFormId){t.next=13;break}return t.prev=1,t.next=4,e.$axios.get("FormLedgerAccount/GetByFormIdHccs?formId=".concat(e.selectedFormId));case 4:r=t.sent,e.ledgerAccounts=r.data.data.map((function(e){return f(f({},e),{},{name:e.ledgerAccount.name,code:e.ledgerAccount.code})})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e.$toast.error(t.t0.message,"Error al obtener cuentas",e.izitoastConfig);case 11:t.next=14;break;case 13:e.ledgerAccounts=[];case 14:case"end":return t.stop()}}),t,null,[[1,8]])})))()},fetchAllLedgerAccounts:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("LedgerAccount/GetAll");case 3:r=t.sent,e.allLedgerAccounts=r.data.data.map((function(e){return{value:e.id,text:"".concat(e.code," - ").concat(e.name)}})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.$toast.error(t.t0.message,"Error al obtener cuentas",e.izitoastConfig);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},addLedgerAccount:function(){this.rowId=null,this.selectedLedgerAccountId=null,this.$refs.ledgerAccountModal.show()},editLedgerAccount:function(e){this.selectedLedgerAccountId=e.ledgerAccountId,this.rowId=e.id,this.$refs.ledgerAccountModal.show()},saveLedgerAccount:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.selectedLedgerAccountId){t.next=14;break}if(data={ledgerAccountId:e.selectedLedgerAccountId,formId:e.selectedFormId,id:e.rowId,lastModifiedDate:new Date,createdDate:new Date,isActive:!0,Index:e.selectedLedgerOrden},null!==e.rowId&&void 0!==e.rowId){t.next=8;break}return t.next=6,e.$axios.post("FormLedgerAccount/Create",data);case 6:t.next=11;break;case 8:return t.next=10,e.$axios.put("FormLedgerAccount/Update",data);case 10:e.rowId=null;case 11:return e.$toast.success("Guardado.","Éxito",e.izitoastConfig),t.next=14,e.fetchLedgerAccounts();case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),e.$toast.error(t.t0.message,"Error al agregar cuenta",e.izitoastConfig);case 19:return t.prev=19,e.$refs.ledgerAccountModal.hide(),t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[0,16,19,22]])})))()},deleteLedgerAccount:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d.a.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});case 3:if(!r.sent.isConfirmed){r.next=11;break}return data={id:e,lastModifiedDate:new Date,isActive:!1},r.next=8,t.$axios.put("FormLedgerAccount/Update",data);case 8:return t.$toast.success("Cuenta eliminada correctamente.","Éxito",t.izitoastConfig),r.next=11,t.fetchLedgerAccounts();case 11:r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),t.$toast.error(r.t0.message,"Error al eliminar la cuenta",t.izitoastConfig);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))()},moveLedgerAccountUp:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!((n=t.ledgerAccounts.findIndex((function(t){return t.id===e.id})))>0)){r.next=6;break}return t.ledgerAccounts[n].index=t.ledgerAccounts[n].index+1,r.next=5,t.updateLedgerAccount(t.ledgerAccounts[n]);case 5:t.fetchLedgerAccounts();case 6:case"end":return r.stop()}}),r)})))()},moveLedgerAccountDown:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!((n=t.ledgerAccounts.findIndex((function(t){return t.id===e.id})))<t.ledgerAccounts.length-1)){r.next=6;break}return t.ledgerAccounts[n].index=t.ledgerAccounts[n].index-1,r.next=5,t.updateLedgerAccount(t.ledgerAccounts[n]);case 5:t.fetchLedgerAccounts();case 6:case"end":return r.stop()}}),r)})))()},updateLedgerAccount:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,data={ledgerAccountId:e.ledgerAccountId,formId:t.selectedFormId,id:e.id,lastModifiedDate:new Date,createdDate:new Date,isActive:!0,index:e.index},r.next=4,t.$axios.put("FormLedgerAccount/Update",data);case 4:r.next=9;break;case 6:r.prev=6,r.t0=r.catch(0),t.$toast.error(r.t0.message,"Error al actualizar la cuenta",t.izitoastConfig);case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()}}},v=r(17),component=Object(v.a)(m,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"card"},[t("div",{staticClass:"card-body"},[t("h4",[e._v("Gestión de Cuentas por Formulario")]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6 mb-2"},[t("b-form-group",{attrs:{label:"Formulario","label-for":"formSelect"}},[t("b-form-select",{attrs:{id:"formSelect",options:e.forms},on:{change:e.fetchLedgerAccounts},model:{value:e.selectedFormId,callback:function(t){e.selectedFormId=t},expression:"selectedFormId"}})],1)],1)]),e._v(" "),e.selectedFormId?t("div",[t("h5",[e._v("Cuentas asociadas al formulario:")]),e._v(" "),t("b-button",{attrs:{variant:"primary"},on:{click:e.addLedgerAccount}},[t("i",{staticClass:"bx bx-plus"})]),e._v(" "),t("b-table",{attrs:{striped:"",hover:"",items:e.ledgerAccounts.slice().sort((function(a,b){return a.index-b.index})),fields:e.ledgerAccountFields},scopedSlots:e._u([{key:"cell(actions)",fn:function(r){return[t("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(t){return e.editLedgerAccount(r.item)}}},[t("i",{staticClass:"bx bx-edit"})]),e._v(" "),t("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(t){return e.deleteLedgerAccount(r.item.id)}}},[t("i",{staticClass:"bx bx-trash"})]),e._v(" "),t("b-button",{attrs:{size:"sm",variant:"info"},on:{click:function(t){return e.moveLedgerAccountUp(r.item)}}},[t("i",{staticClass:"bx bx-down-arrow-alt"})]),e._v(" "),t("b-button",{attrs:{size:"sm",variant:"info"},on:{click:function(t){return e.moveLedgerAccountDown(r.item)}}},[t("i",{staticClass:"bx bx-up-arrow-alt"})])]}}],null,!1,4176020864)}),e._v(" "),t("b-button",{attrs:{variant:"primary"},on:{click:e.addLedgerAccount}},[t("i",{staticClass:"bx bx-plus"})])],1):e._e()])]),e._v(" "),t("b-modal",{ref:"ledgerAccountModal",attrs:{title:"Cuenta","hide-footer":""}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.saveLedgerAccount.apply(null,arguments)}}},[t("b-form-group",{attrs:{label:"Cuenta","label-for":"ledgerAccountSelect"}},[t("vueselect",{attrs:{options:e.allLedgerAccounts,reduce:function(e){return e.value},label:"text"},model:{value:e.selectedLedgerAccountId,callback:function(t){e.selectedLedgerAccountId=t},expression:"selectedLedgerAccountId"}})],1),e._v(" "),t("b-form-group",{attrs:{label:"Orden","label-for":"ledgerAccountSelect"}},[t("b-input",{attrs:{id:"ledgerAccountSelect"},model:{value:e.selectedLedgerOrden,callback:function(t){e.selectedLedgerOrden=t},expression:"selectedLedgerOrden"}})],1),e._v(" "),t("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Guardar")])],1)])],1)}),[],!1,null,null,null);t.default=component.exports}}]);